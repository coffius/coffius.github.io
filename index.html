<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]> <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]> <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>KOFF.io </title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1">


<meta name="description" content="" />

<meta name="keywords" content="">

<link rel="author" href="http://plus.google.com/+102671541320733671208">


<meta property="og:title" content="KOFF.io ">
<meta property="og:site_name" content="KOFF.io"/>
<meta property="og:url" content="http://coffius.github.io/" />
<meta property="og:locale" content="en-EN">


<meta property="og:type" content="website" />



<link href="http://coffius.github.io/index.xml" rel="alternate" type="application/rss+xml" title="KOFF.io" />

<link rel="canonical" href="http://coffius.github.io/" />

<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://coffius.github.io/touch-icon-144-precomposed.png">
<link href="http://coffius.github.io/favicon.png" rel="icon">

<meta name="generator" content="Hugo 0.14" />

  <!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<link href='https://fonts.googleapis.com/css?family=Merriweather:300%7CRaleway%7COpen+Sans' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="http://coffius.github.io/css/font-awesome.min.css">
<link rel="stylesheet" href="http://coffius.github.io/css/style.css">
<link rel="stylesheet" href="http://coffius.github.io/css/highlight/default.css">

  
</head>
<body>
  <main id="main-wrapper" class="container main_wrapper has-sidebar">
    <header id="main-header" class="container main_header">
  <div class="container brand">
  <div class="container title h1-like">
  <a class="baselink" href="http://coffius.github.io/">
  KOFF.io

</a>

</div>

  
<div class="container topline">
  
  where scala is beloved


</div>


</div>

  <nav class="container nav primary no-print">
  

<a class="homelink" href="http://coffius.github.io/">Home</a>


  
<a href="http://coffius.github.io/about">About</a>

<a href="http://coffius.github.io/post" title="Show list of posts">Posts</a>

<a href="http://coffius.github.io/tags" title="Show list of tags">Tags</a>


</nav>

<div class="container nav secondary no-print">
  


<a id="contact-link-github" class="contact_link" href="https://github.com/coffius">
  <span class="fa fa-github-square"></span><span>github</span></a>







<a id="contact-link-googleplus" class="contact_link" href="https://plus.google.com/u/0/+102671541320733671208">
  <span class="fa fa-google-plus-square"></span><span>google+</span></a>





<a id="contact-link-twitter" class="contact_link" href="https://twitter.com/coffius">
  <span class="fa fa-twitter-square"></span><span>twitter</span></a>







</div>


  

</header>


<section id="main-content" class="container main_content homepage">
  <header class="container header">
    <h1>KOFF.io
</h1>

    <span>last update: <time datetime="2015-11-27T00:11:00&#43;03:00">27 November at 12:11am</time>
</span>

  </header>
  
  
    <article class="container content summary">
  <div class="container hat">
  <h2><a href="http://coffius.github.io/posts/292173-validation-in-scala">Validation in scala
</a>
</h2>

  <time datetime="2015-11-27">27 Nov, 2015</time>

</div>

  <p class="container content">
  
  
    <p>This article is about possible solutions for validation in scala. Validation is the process of checking input data in order to provide its correctness and requirements compliance.</p>

<h1 id="implementations">Implementations</h1>

<p>There are several libraries in scala which can be used for validation:</p>

<ul>
<li><strong><a href="https://github.com/wix/accord" title="GitHub: Accord">Accord</a></strong> - Accord is a validation library written in and for Scala. <a href="http://wix.github.io/accord/" title="Accord: Docs">Docs here</a></li>
<li><strong>Skinny validator</strong> - skinny-validator is a portable library, so it is possible to use skinny-validator with Play2, Scalatra and any other web app frameworks. <a href="http://skinny-framework.org/documentation/validator.html" title="Skinny Validator: Docs">Docs here</a></li>
<li><strong><a href="https://github.com/tobnee/DValidation/" title="GitHub: DValidation">DValidation</a></strong> - A little, opinionated Scala domain object validation toolkit</li>
<li><strong><a href="https://github.com/davegurnell/validation" title="GitHub: io.underscore.validation">io.underscore.validation</a></strong> - Work-in-progress library demonstrating a functional programming approach to data validation in Scala</li>
</ul>

<p>The source code for this article is <strong><a href="https://github.com/coffius/koffio-validation">here</a></strong></p>

  


</p>


  <div class="container readlink">
  <a href="http://coffius.github.io/posts/292173-validation-in-scala">Read more &rarr;</a>

</div>


</article>

  
    <article class="container content summary">
  <div class="container hat">
  <h2><a href="http://coffius.github.io/posts/using-t-digest">Using T-Digest: Median calculation and anomaly detection
</a>
</h2>

  <time datetime="2015-10-13">13 Oct, 2015</time>

</div>

  <p class="container content">
  
  
    <p>In this article you can find information about using <code>t-digest</code> library in order to measure average value of some quantity(average session time).
There is also an answer for the question: What and why should you use to make such the measurement mean or median?
Besides, list and comparison of different implementations is presented below in the article.</p>

<h2 id="main-problem">Main problem</h2>

<p>So in what cases we have need to calculate mean/median? For example we have a site and we want to understand how much time an average user spent on our site.
In order to do it we should calculate an average duration of a user session.
And there are at least two ways to do it - calculate an arithmetic mean(or just mean) or calculate a median.
The calculation of mean is very simple. You need two fields: one for a sum of elements and another for their count. But it doesn`t work very well with anomalies in the data.
I mean the case when one or several elements differ greatly from others.
Lets assume that we have such values for our session durations(in milliseconds):</p>

<pre><code>3000, 2000, 3000, 5000, 3000, 4000, 4500, 3200, 2700, 3380
</code></pre>

<p>mean = <code>(3000+2000+3000+5000+3000+4000+4500+3200+2700+3380) / 10 = 3378 msecs</code>. In this case all is ok.</p>

<p>But what if one of these users opens the site, forgets to close a browser tab and goes afk for an hour(3.600.000 msecs):</p>

<pre><code>3000, 2000, 3000, 5000, 3000, 4000, 4500, 3200, 2700, 3600000
</code></pre>

<p>mean = <code>(3000+2000+3000+5000+3000+4000+4500+3200+2700+3600000) / 10 = 363040 msecs</code>. Just one of the users influences strongly on mean value.
Generally speaking, the mean is only representative if the distribution of the data is symmetric, otherwise it may be heavily influenced by outlying measurements.
In simple cases it is possible to use some kind of a filter.
But often we just don&rsquo;t know what threshold we should use to filter values.
Whereas the median value is the same in both cases and is equal to <code>3100</code>. So in the cases like this the median will be more useful then the mean.
However the calculation of the median in general case needs a lot of memory - O(n)</p>

  


</p>


  <div class="container readlink">
  <a href="http://coffius.github.io/posts/using-t-digest">Read more &rarr;</a>

</div>


</article>

  
    <article class="container content summary">
  <div class="container hat">
  <h2><a href="http://coffius.github.io/posts/comparison-of-hll">Comparison of HLL implementations
</a>
</h2>

  <time datetime="2015-09-22">22 Sep, 2015</time>

</div>

  <p class="container content">
  
  
    <p>In this article we will look at HLL algorithm and different implementations of it.</p>

<h2 id="general-info">General Info</h2>

<p>HLL is a propabalistic algorithm which is used for a estimation of unique values.
More details about HLL you can get <a href="https://en.wikipedia.org/wiki/HyperLogLog" title="Wikipedia:HyperLogLog">here</a>.
The main reason to use HLL is necessity to estimate uniques in very big amount of data in case if it is possible to sacrifice accuracy of an unique counter.</p>

<h2 id="list-of-implementations">List of implementations</h2>

<p>You can find several implementations of HLL:</p>

<ul>
<li><a href="https://github.com/twitter/algebird" title="twitter/algebird">twitter/algebird</a> - a scala library from twitter which contains lots of different algorithms including HLL</li>
<li><a href="https://github.com/prasanthj/hyperloglog" title="prasanthj/hyperloglog">prasanthj/hyperloglog</a> - a detached java library for HLL</li>
<li><a href="https://github.com/addthis/stream-lib" title="addthis/stream-lib">addthis/stream-lib</a> - another java lib which have an implementation of HLL.</li>
<li><a href="https://github.com/aggregateknowledge/java-hll" title="java-hll">aggregateknowledge/java-hll</a> - a low-level java implementation of HLL</li>
</ul>

<p>Next in this article we will take a close look at all these libs and answer the question: &laquo;Why should we use HLL?&raquo;.</p>

  


</p>


  <div class="container readlink">
  <a href="http://coffius.github.io/posts/comparison-of-hll">Read more &rarr;</a>

</div>


</article>

  
    <article class="container content summary">
  <div class="container hat">
  <h2><a href="http://coffius.github.io/posts/292173-lens-in-scala">Lens in scala
</a>
</h2>

  <time datetime="2015-09-19">19 Sep, 2015</time>

</div>

  <p class="container content">
  
  
    <p>In this article let&rsquo;s take a look at such a thing as lens(or lenses).
A Lens is an abstraction from functional programming which helps to deal with a problem of updating complex immutable nested objects like this:</p>

<pre><code class="language-scala">case class User(id: UserId, generalInfo: GeneralInfo, billInfo: BillInfo)
case class UserId(value: Long)
case class GeneralInfo(email: Email,
                       password: String,
                       siteInfo: SiteInfo,
                       isEmailConfirmed: Boolean = false,
                       phone: String,
                       isPhoneConfirmed: Boolean = false)
case class SiteInfo(alias: String, avatarUrl: String, userRating: Double = 0.0d)
case class Email(value: String)
case class BillInfo(addresses: Seq[Address], name: Name)
case class Name(firstName: String, secondName: String)
case class Address(country: Country, city: City, street: String, house: String, isConfirmed: Boolean = false)
case class City(name: String)
case class Country(name: String)
</code></pre>

<p>If we want to increase <code>userRating</code> in this model then we will have to write such a code:</p>

<pre><code class="language-scala">val updatedUser = user.copy(
  generalInfo = user.generalInfo.copy(
    siteInfo = user.generalInfo.siteInfo.copy(
      userRating = user.generalInfo.siteInfo.userRating + 1
    )
  )
)
</code></pre>

<p>And we have to write the code below to confirm all of the addresses in BillInfo</p>

<pre><code class="language-scala">val updatedAddresses = user.billInfo.addresses.map(_.copy(isConfirmed = true))
val updatedUser = user.copy(
	billInfo = user.billInfo.copy(addresses = updatedAddresses)
)
</code></pre>

<p>If we increase a level of nesting in our structures then we will considerably increase amount of a code like this. In such cases lens give a cleaner way to make changes in nested structures.</p>

  


</p>


  <div class="container readlink">
  <a href="http://coffius.github.io/posts/292173-lens-in-scala">Read more &rarr;</a>

</div>


</article>

  
    <article class="container content summary">
  <div class="container hat">
  <h2><a href="http://coffius.github.io/posts/291279-true-fail-fast-with-expression-magic">True fail-fast async error handling with Expression
</a>
</h2>

  <time datetime="2015-09-12">12 Sep, 2015</time>

</div>

  <p class="container content">
  
  
    <p>How it was said in the previous <a href="http://koff.io/posts/290071-make-async-with-scalaz-either-and-futures">article</a> there is no way to do truly fail-fast async error handling using only scala or scalaz.</p>

<p>Look at the example below:</p>

<pre><code class="language-scala">val longFut = longFuture() // very long future
val shortFut = shortFuture()
val failedFut = failedFuture() // throw new IllegalStateException(&quot;future is failed&quot;)

val result = for {
  long &lt;- longFut
  short &lt;- shortFut
  failed &lt;- failedFut
} yield {
  long + &quot; | &quot; + short + &quot; | &quot; + failed
}
</code></pre>

<p>In that example we will wait all the futures until we get <code>IllegalStateException</code> because <code>for-comprehension</code> always handle futures in the order which we define them since Scala translates the example above to this:</p>

<pre><code class="language-scala">longFut.flatMap { long =&gt;
  shortFut.flatMap { short =&gt;
    failedFut.map { failed =&gt;
      long + &quot; | &quot; + short + &quot; | &quot; + failed
    }
  }
}
</code></pre>

<p>But it is possible to avoid this problem with Expression library(<a href="https://github.com/jedesah/computation-expressions" title="Computation-expressions">link</a>)</p>

  


</p>


  <div class="container readlink">
  <a href="http://coffius.github.io/posts/291279-true-fail-fast-with-expression-magic">Read more &rarr;</a>

</div>


</article>

  
    <article class="container content summary">
  <div class="container hat">
  <h2><a href="http://coffius.github.io/posts/290071-make-async-with-scalaz-either-and-futures">Practical Scalaz: Make async operations with scalaz.Either and Futures
</a>
</h2>

  <time datetime="2015-09-05">5 Sep, 2015</time>

</div>

  <p class="container content">
  
  
    <p>Many of us know about such library as scalaz. For those who don&rsquo;t know it is a library for functional programming in scala. You can find it <a href="https://github.com/scalaz/scalaz" title="Scalaz on github">here</a>.
Then I was trying to learn and understand this lib it was quite difficult to realize how exactly it can be used in a real code in a real system. I looked thought lots of articles about it, but there were only abstract examples. So I`ve decided to write a little example in order to show how scalaz can be used in a real system.</p>

<h2 id="intro">Intro</h2>

<p><strong>Idea:</strong> Future and scalaz.Either can be used as a result of an asynchronous operation.</p>

<p><strong>Reason:</strong> We must compose futures and eithers in order to deal with possible errors which may occur during execution of async operations.</p>

<p>For example we have to gather information from several different DBs and an external service like Twitter. We also don`t want to use exceptions as notifications about errors. Why? Because it sucks ^_^ It will be better if exceptions are used for something really exceptional. One more thing which we should implement is fail-fast error handling because it will be wasteful to continue program execution if it already contains some errors.</p>

  


</p>


  <div class="container readlink">
  <a href="http://coffius.github.io/posts/290071-make-async-with-scalaz-either-and-futures">Read more &rarr;</a>

</div>


</article>

  
  

</section>

      <footer id="main-footer" class="container main_footer">
  

  <div class="container nav foot no-print">
  
<a href="http://coffius.github.io/license">license</a>


  <a class="toplink" href="#">back to top</a>

</div>

  <div class="container credits">
  
<div class="container footline">
  
  code with <i class='fa fa-heart'></i>


</div>


  
<div class="container copyright">
  
  &copy; 2015


</div>


</div>

</footer>

    </main>
    
<script type="text/javascript">
  (function() {
    
    
    if (window.location.hostname == "localhost")
      return;

    var dsq = document.createElement('script'); dsq.async = true; dsq.type = 'text/javascript';
    dsq.src = '//koff-io.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>



<script src="http://coffius.github.io/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>



<script>
  var _gaq=[['_setAccount','102671541320733671208'],['_trackPageview']];
  (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
  g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
  s.parentNode.insertBefore(g,s)}(document,'script'));
</script>


    
  </body>
</html>

