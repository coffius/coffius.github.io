<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-EN" lang="en-EN">
<head>
    










    







<script defer language="javascript" type="text/javascript" src="/js/bundle.min.a43a549406127e0715f68083c987d71d0c71054cd57edea77aa709ed9958af6e.js"></script>






    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">

    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    
    <link rel="icon" href=/favicon.png>

    
    





  
  






<!-- Open Graph image and Twitter Card metadata -->

<title itemprop="name">KOFF.io</title>
<meta property="og:title" content=KOFF.io />
<meta name="twitter:title" content=KOFF.io />
<meta itemprop="name" content=KOFF.io />
<meta name="application-name" content=KOFF.io />
<meta property="og:site_name" content="KOFF.io" />


<meta name="description" content="❤ Scala since 2015" />
<meta itemprop="description" content="❤ Scala since 2015" />
<meta property="og:description" content="❤ Scala since 2015" />
<meta name="twitter:description" content="❤ Scala since 2015" />


<base href="https://coffius.github.io/" />
<link rel="canonical" href="https://coffius.github.io/" itemprop="url" />
<meta name="url" content="https://coffius.github.io/" />
<meta name="twitter:url" content="https://coffius.github.io/" />
<meta property="og:url" content="https://coffius.github.io/" />


<meta property="og:updated_time" content=18003-18-06T355:00:24&#43;0300 />


<link rel="sitemap" type="application/xml" title="Sitemap" href='https://coffius.github.io/sitemap.xml' />
<link href="https://coffius.github.io/index.xml" rel="alternate" type="application/rss+xml" title="KOFF.io" />

<meta name="robots" content="index,follow" />
<meta name="googlebot" content="index,follow" />


<meta name="twitter:site" content="https://twitter.com/coffius" />
<meta name="twitter:creator" content="https://twitter.com/coffius" />
<meta property="fb:admins" content="" />


<meta name="apple-mobile-web-app-title" content="KOFF.io" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black" />






<meta name="generator" content="Hugo 0.119.0">


    
    

<link type="text/css" rel="stylesheet" href="/css/bundle.min.840ebf68f48532db154ba044710ddddf80dfb1f4b417dbd6469c0e3cd316e782.css">


    
    <style>
    body {
        --sidebar-bg-color: #202020;
        --sidebar-img-border-color: #515151;
        --sidebar-p-color: #909090;
        --sidebar-h1-color: #FFF;
        --sidebar-a-color: #FFF;
        --sidebar-socials-color: #FFF;
        --text-color: #222;
        --bkg-color: #FAF9F6;
        --post-title-color: #303030;
        --list-color: #5a5a5a;
        --link-color: #268bd2;
        --date-color: #515151;
        --table-border-color: #E5E5E5;
        --table-stripe-color: #F9F9F9;
        --code-color: #000;
        --code-background-color: #E5E5E5;
        --code-block-color: #fff;
        --code-block-background-color: #272822;
        --moon-sun-color: #FFF;
        --moon-sun-background-color: #515151;
    }
    body.dark-theme {
        --text-color: #eee;
        --bkg-color: #121212;
        --post-title-color: #DBE2E9;
        --list-color: #9d9d9d;
        --link-color: #268bd2;
        --date-color: #9a9a9a;
        --table-border-color: #515151;
        --table-stripe-color: #202020;
        --code-color: #fff;
        --code-background-color: #515151;
        --code-block-color: #fff;
        --code-block-background-color: #272822;
    }
    body {
        background-color: var(--bkg-color);
    }
</style>

</head>

    <body class="dark-theme">
        <div class="wrapper">
            <aside class="sidebar">
    <div class="container sidebar-sticky">
        <div class="light-dark" align="right">
    <button class="btn-light-dark" title="Toggle light/dark mode">
        <svg class="moon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16">
            <path fill="currentColor" d="M6 .278a.768.768 0 0 1 .08.858a7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277c.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316a.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71C0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"/>
        </svg>
        <svg class="sun" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16">
            <path fill="currentColor" d="M8 12a4 4 0 1 0 0-8a4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/>
        </svg>
    </button>
</div>

        <div class="sidebar-about">
    <h1 class="brand">
        
        
            <a href="https://coffius.github.io/">
                <h1>KOFF.io</h1>
            </a>
        
    </h1>
    <p class="lead">
    ❤ Scala since 2015
    </p>
</div>

        <nav>
    <ul class="sidebar-nav">

        
        
        

    </ul>
</nav>

        <div class = "social-links">
    
    <a target="_blank" class="social" title="GitHub" href="https://github.com/coffius">
        <svg xmlns="http://www.w3.org/2000/svg" width="1.2em" height="1.2em" viewBox="-2 -2 24 24">
            <path fill="currentColor" d="M18.88 1.099C18.147.366 17.265 0 16.233 0H3.746C2.714 0 1.832.366 1.099 1.099C.366 1.832 0 2.714 0 3.746v12.487c0 1.032.366 1.914 1.099 2.647c.733.733 1.615 1.099 2.647 1.099H6.66c.19 0 .333-.007.429-.02a.504.504 0 0 0 .286-.169c.095-.1.143-.245.143-.435l-.007-.885c-.004-.564-.006-1.01-.006-1.34l-.3.052c-.19.035-.43.05-.721.046a5.555 5.555 0 0 1-.904-.091a2.026 2.026 0 0 1-.872-.39a1.651 1.651 0 0 1-.572-.8l-.13-.3a3.25 3.25 0 0 0-.41-.663c-.186-.243-.375-.407-.566-.494l-.09-.065a.956.956 0 0 1-.17-.156a.723.723 0 0 1-.117-.182c-.026-.061-.004-.111.065-.15c.07-.04.195-.059.378-.059l.26.04c.173.034.388.138.643.311a2.1 2.1 0 0 1 .631.677c.2.355.44.626.722.813c.282.186.566.28.852.28c.286 0 .533-.022.742-.065a2.59 2.59 0 0 0 .585-.196c.078-.58.29-1.028.637-1.34a8.907 8.907 0 0 1-1.333-.234a5.314 5.314 0 0 1-1.223-.507a3.5 3.5 0 0 1-1.047-.872c-.277-.347-.505-.802-.683-1.365c-.177-.564-.266-1.215-.266-1.952c0-1.049.342-1.942 1.027-2.68c-.32-.788-.29-1.673.091-2.652c.252-.079.625-.02 1.119.175c.494.195.856.362 1.086.5c.23.14.414.257.553.352a9.233 9.233 0 0 1 2.497-.338c.859 0 1.691.113 2.498.338l.494-.312a6.997 6.997 0 0 1 1.197-.572c.46-.174.81-.221 1.054-.143c.39.98.424 1.864.103 2.653c.685.737 1.028 1.63 1.028 2.68c0 .737-.089 1.39-.267 1.957c-.177.568-.407 1.023-.689 1.366a3.65 3.65 0 0 1-1.053.865c-.42.234-.828.403-1.223.507a8.9 8.9 0 0 1-1.333.235c.45.39.676 1.005.676 1.846v3.11c0 .147.021.266.065.357a.36.36 0 0 0 .208.189c.096.034.18.056.254.064c.074.01.18.013.318.013h2.914c1.032 0 1.914-.366 2.647-1.099c.732-.732 1.099-1.615 1.099-2.647V3.746c0-1.032-.367-1.914-1.1-2.647z"/>
        </svg>
    </a>
    
    
    
    
    <a target="_blank" class="social" title="Twitter" href="https://twitter.com/coffius">
        <svg xmlns="http://www.w3.org/2000/svg" width="1.2em" height="1.2em" viewBox="0 0 16 16">
            <path fill="currentColor" d="M5.032 14.286c6.037 0 9.34-4.837 9.34-9.032c0-.137 0-.274-.01-.41A6.56 6.56 0 0 0 16 3.2c-.6.256-1.235.425-1.885.5a3.207 3.207 0 0 0 1.443-1.757c-.645.37-1.35.63-2.085.77a3.322 3.322 0 0 0-1.862-.958a3.384 3.384 0 0 0-2.082.334a3.223 3.223 0 0 0-1.442 1.49a3.08 3.08 0 0 0-.208 2.03a9.57 9.57 0 0 1-3.747-.963a9.269 9.269 0 0 1-3.018-2.354a3.086 3.086 0 0 0-.36 2.314c.189.787.68 1.475 1.376 1.924a3.344 3.344 0 0 1-1.49-.398v.04c0 .734.263 1.444.743 2.01a3.3 3.3 0 0 0 1.89 1.102c-.483.128-.99.146-1.482.055a3.19 3.19 0 0 0 1.168 1.577a3.36 3.36 0 0 0 1.9.627A6.732 6.732 0 0 1 0 12.86a9.527 9.527 0 0 0 5.032 1.423"/>
        </svg>
    </a>
    
    
    
    
    
    
    
    
    
    
    
    
    
</div>
        <p class="footnote">
powered by <a target="_blank" href="https://gohugo.io">Hugo</a> | themed with <a target="_blank" href="https://github.com/lukeorth/poison">poison</a>
    <br>
    &copy; 2024 coffius. All rights reserved.
</p>

  </div>
</aside>

            <main class="content container">
                <div class="posts">
    
    
    <article class="post">
        <div class="info">
    <h1 class="post-title">
        <a href="https://coffius.github.io/posts/tf-gathering-effects/">Gathering effects in Tagless Final</a>
    </h1>
    
        <time datetime="2024-03-18T18:55:00&#43;0300" class="post-date">
            March 18, 2024
        </time>
    
    
    
    
    
    
    
</div>

        
        <p>Developers who has experience with Scala know how to work with side effects. Find them, wrap each of them with <code>IO.delay{..}</code> to get an effect, chain them together using <code>Apply[F]</code> or <code>Monad[F]</code>, run the result program as <code>IOApp</code>.
In this case all side effects are launched in such an order as they are chained in the result <code>IO[..]</code>. But there is another way of working with a certain type of effectful computations. It could improve testability and control over how these computations are executed. So in this article I&rsquo;d like to show how to gather and process these effects later, after the logic itself is executed in full.</p>
        
        <div class="read-more-link">
            <a href="/posts/tf-gathering-effects/">Read More…</a>
        </div>
        
        
    </article>
    <article class="post">
        <div class="info">
    <h1 class="post-title">
        <a href="https://coffius.github.io/posts/tf-context-passing/">Context Passing in Tagless Final</a>
    </h1>
    
        <time datetime="2023-08-30T10:00:00&#43;0300" class="post-date">
            August 30, 2023
        </time>
    
    
    
    
    
    
    
</div>

        
        <p>Context passing is the thing that all programmers face regardless of a programming language they use.
In this article I&rsquo;d like to discuss the ways how this can be solved in Scala using Cats Effect, ZIO, cats-mtl and the tagless final encoding.</p>
        
        <div class="read-more-link">
            <a href="/posts/tf-context-passing/">Read More…</a>
        </div>
        
        
    </article>
    <article class="post">
        <div class="info">
    <h1 class="post-title">
        <a href="https://coffius.github.io/posts/shapeless-sums/">Sum Data Types with Shapeless</a>
    </h1>
    
        <time datetime="2018-04-16T10:00:00&#43;0300" class="post-date">
            April 16, 2018
        </time>
    
    
    
    
    
    
    
</div>

        
        <p>Scala has support of algebraic data types out of the box but often it is not enough for complex cases.
In this article I will try to show its limits and how to bypass them using <code>shapeless</code> library by the example of <code>sum data types</code>.</p>
<h2 id="contents">Contents</h2>
<ul>
<li><a href="/posts/shapeless-sums/#what-is-adt">What is ADT?</a></li>
<li><a href="/posts/shapeless-sums/#sealed-trait-as-a-sum-type">Sealed trait as a sum type</a></li>
<li><a href="/posts/shapeless-sums/#extending-adts-using-wrapper-evidence">Extending ADTs using Wrapper + Evidence</a></li>
<li><a href="/posts/shapeless-sums/#coproduct-as-a-sum-type">Coproduct as a sum type</a></li>
<li><a href="/posts/shapeless-sums/#poly1-as-pattern-matching">Poly1 as pattern matching</a></li>
<li><a href="/posts/shapeless-sums/#merging-sum-types-with-shapeless">Merging sum types with Shapeless</a></li>
</ul>
        
        <div class="read-more-link">
            <a href="/posts/shapeless-sums/">Read More…</a>
        </div>
        
        
    </article>
    <article class="post">
        <div class="info">
    <h1 class="post-title">
        <a href="https://coffius.github.io/posts/hll-in-cassandra/">HLL counters as Cassandra user defined aggregates</a>
    </h1>
    
        <time datetime="2016-12-04T18:00:00&#43;0300" class="post-date">
            December 4, 2016
        </time>
    
    
    
    
    
    
    
</div>

        
        <p>In <a href="../comparison-of-hll">the previous article</a> we discussed usage of hll countes for finding the number of unique values in a collection. But in this article we will see how to use them in Cassandra db internally in order to provide such functionality using user defined functions(UDF) and aggregates(UDA).</p>
        
        <div class="read-more-link">
            <a href="/posts/hll-in-cassandra/">Read More…</a>
        </div>
        
        
    </article>
    <article class="post">
        <div class="info">
    <h1 class="post-title">
        <a href="https://coffius.github.io/posts/variance-tip-notes/">Tips about variance in scala</a>
    </h1>
    
        <time datetime="2016-11-26T22:51:18&#43;0300" class="post-date">
            November 26, 2016
        </time>
    
    
    
    
    
    
    
</div>

        
        <p>Type variance in scala is quite a tricky topic especially if you do not use it often - details might slip out of mind easily in this case. So below you can find very short tips about it which purpose is to remind how it works.</p>
        
        <div class="read-more-link">
            <a href="/posts/variance-tip-notes/">Read More…</a>
        </div>
        
        
    </article>
    <article class="post">
        <div class="info">
    <h1 class="post-title">
        <a href="https://coffius.github.io/posts/pagination-and-streams/">Pagination and Streams</a>
    </h1>
    
        <time datetime="2016-04-10T00:20:00&#43;0300" class="post-date">
            April 10, 2016
        </time>
    
    
    
    
    
    
    
</div>

        
        <p>In this article we will see how to use different streams(like akka-stream) for pagination and when it can be useful.
The main idea of pagination is partition of a big sequence of objects into several parts(or pages) in order to make possible its processing page by page.
For example, you have a 1.000.000 users in the database and you need to send an email to all of them.
You could try to load all user records in a big list and process it at once but it would not be memory-efficient approach.
Instead you can partition the list of users into pages by 100 users per page, load one page, send emails to users in this page, load next page and so on.
This will be a much more efficient way to deal with big collections of records.</p>
<p>So lets try to implement this approach but for a more complex case.</p>
        
        <div class="read-more-link">
            <a href="/posts/pagination-and-streams/">Read More…</a>
        </div>
        
        
    </article>
    <article class="post">
        <div class="info">
    <h1 class="post-title">
        <a href="https://coffius.github.io/posts/292173-validation-in-scala/">Validation in scala</a>
    </h1>
    
        <time datetime="2015-11-27T00:11:00&#43;0300" class="post-date">
            November 27, 2015
        </time>
    
    
    
    
    
    
    
</div>

        
        <p>This article is about possible solutions for validation in scala. Validation is the process of checking input data in order to provide its correctness and requirements compliance.</p>
<h1 id="implementations">Implementations</h1>
<p>There are several libraries in scala which can be used for validation:</p>
<ul>
<li><strong><a href="https://github.com/wix/accord" title="GitHub: Accord" target="_blank">Accord</a></strong> - Accord is a validation library written in and for Scala. <a href="http://wix.github.io/accord/" title="Accord: Docs" target="_blank">Docs here</a></li>
<li><strong>Skinny validator</strong> - skinny-validator is a portable library, so it is possible to use skinny-validator with Play2, Scalatra and any other web app frameworks. <a href="http://skinny-framework.org/documentation/validator.html" title="Skinny Validator: Docs" target="_blank">Docs here</a></li>
<li><strong><a href="https://github.com/tobnee/DValidation/" title="GitHub: DValidation" target="_blank">DValidation</a></strong> - A little, opinionated Scala domain object validation toolkit</li>
<li><strong><a href="https://github.com/davegurnell/validation" title="GitHub: io.underscore.validation" target="_blank">io.underscore.validation</a></strong> - Work-in-progress library demonstrating a functional programming approach to data validation in Scala</li>
</ul>
<p>The source code for this article is <strong><a href="https://github.com/coffius/koffio-validation" target="_blank">here</a></strong></p>
        
        <div class="read-more-link">
            <a href="/posts/292173-validation-in-scala/">Read More…</a>
        </div>
        
        
    </article>
    <article class="post">
        <div class="info">
    <h1 class="post-title">
        <a href="https://coffius.github.io/posts/using-t-digest/">Using T-Digest: Median calculation and anomaly detection</a>
    </h1>
    
        <time datetime="2015-10-13T22:01:13&#43;0300" class="post-date">
            October 13, 2015
        </time>
    
    
    
    
    
    
    
</div>

        
        <p>In this article you can find information about using <code>t-digest</code> library in order to measure average value of some quantity(average session time).
There is also an answer for the question: What and why should you use to make such the measurement mean or median?
Besides, list and comparison of different implementations is presented below in the article.</p>
<h2 id="main-problem">Main problem</h2>
<p>So in what cases we have need to calculate mean/median? For example we have a site and we want to understand how much time an average user spent on our site.
In order to do it we should calculate an average duration of a user session.
And there are at least two ways to do it - calculate an arithmetic mean(or just mean) or calculate a median.
The calculation of mean is very simple. You need two fields: one for a sum of elements and another for their count. But it doesn`t work very well with anomalies in the data.
I mean the case when one or several elements differ greatly from others.
Lets assume that we have such values for our session durations(in milliseconds):</p>
<pre tabindex="0"><code>3000, 2000, 3000, 5000, 3000, 4000, 4500, 3200, 2700, 3380
</code></pre><p>mean = <code>(3000+2000+3000+5000+3000+4000+4500+3200+2700+3380) / 10 = 3378 msecs</code>. In this case all is ok.</p>
<p>But what if one of these users opens the site, forgets to close a browser tab and goes afk for an hour(3.600.000 msecs):</p>
<pre tabindex="0"><code>3000, 2000, 3000, 5000, 3000, 4000, 4500, 3200, 2700, 3600000
</code></pre><p>mean = <code>(3000+2000+3000+5000+3000+4000+4500+3200+2700+3600000) / 10 = 363040 msecs</code>. Just one of the users influences strongly on mean value.
Generally speaking, the mean is only representative if the distribution of the data is symmetric, otherwise it may be heavily influenced by outlying measurements.
In simple cases it is possible to use some kind of a filter.
But often we just don&rsquo;t know what threshold we should use to filter values.
Whereas the median value is the same in both cases and is equal to <code>3100</code>. So in the cases like this the median will be more useful then the mean.
However the calculation of the median in general case needs a lot of memory - O(n)</p>
        
        <div class="read-more-link">
            <a href="/posts/using-t-digest/">Read More…</a>
        </div>
        
        
    </article>
    <article class="post">
        <div class="info">
    <h1 class="post-title">
        <a href="https://coffius.github.io/posts/comparison-of-hll/">Comparison of HLL implementations</a>
    </h1>
    
        <time datetime="2015-09-22T22:01:13&#43;0300" class="post-date">
            September 22, 2015
        </time>
    
    
    
    
    
    
    
</div>

        
        <p>In this article we will look at HLL algorithm and different implementations of it.</p>
<h2 id="general-info">General Info</h2>
<p>HLL is a propabalistic algorithm which is used for a estimation of unique values.
More details about HLL you can get <a href="https://en.wikipedia.org/wiki/HyperLogLog" title="Wikipedia:HyperLogLog" target="_blank">here</a>.
The main reason to use HLL is necessity to estimate uniques in very big amount of data in case if it is possible to sacrifice accuracy of an unique counter.</p>
<h2 id="list-of-implementations">List of implementations</h2>
<p>You can find several implementations of HLL:</p>
<ul>
<li><a href="https://github.com/twitter/algebird" title="twitter/algebird" target="_blank">twitter/algebird</a> - a scala library from twitter which contains lots of different algorithms including HLL</li>
<li><a href="https://github.com/prasanthj/hyperloglog" title="prasanthj/hyperloglog" target="_blank">prasanthj/hyperloglog</a> - a detached java library for HLL</li>
<li><a href="https://github.com/addthis/stream-lib" title="addthis/stream-lib" target="_blank">addthis/stream-lib</a> - another java lib which have an implementation of HLL.</li>
<li><a href="https://github.com/aggregateknowledge/java-hll" title="java-hll" target="_blank">aggregateknowledge/java-hll</a> - a low-level java implementation of HLL</li>
</ul>
<p>Next in this article we will take a close look at all these libs and answer the question: &ldquo;Why should we use HLL?&rdquo;.</p>
        
        <div class="read-more-link">
            <a href="/posts/comparison-of-hll/">Read More…</a>
        </div>
        
        
    </article>
    <article class="post">
        <div class="info">
    <h1 class="post-title">
        <a href="https://coffius.github.io/posts/292173-lens-in-scala/">Lens in scala</a>
    </h1>
    
        <time datetime="2015-09-19T22:01:13&#43;0300" class="post-date">
            September 19, 2015
        </time>
    
    
    
    
    
    
    
</div>

        
        <p>In this article let&rsquo;s take a look at such a thing as lens(or lenses).
A Lens is an abstraction from functional programming which helps to deal with a problem of updating complex immutable nested objects like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">User</span><span style="color:#f92672">(</span>id<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">UserId</span><span style="color:#f92672">,</span> generalInfo<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">GeneralInfo</span><span style="color:#f92672">,</span> billInfo<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">BillInfo</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UserId</span><span style="color:#f92672">(</span>value<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Long</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">GeneralInfo</span><span style="color:#f92672">(</span>email<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Email</span><span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>                       password<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span><span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>                       siteInfo<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">SiteInfo</span><span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>                       isEmailConfirmed<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Boolean</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>                       phone<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span><span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>                       isPhoneConfirmed<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Boolean</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SiteInfo</span><span style="color:#f92672">(</span>alias<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span><span style="color:#f92672">,</span> avatarUrl<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span><span style="color:#f92672">,</span> userRating<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Double</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0d</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Email</span><span style="color:#f92672">(</span>value<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">BillInfo</span><span style="color:#f92672">(</span>addresses<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Seq</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Address</span><span style="color:#f92672">],</span> name<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Name</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Name</span><span style="color:#f92672">(</span>firstName<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span><span style="color:#f92672">,</span> secondName<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Address</span><span style="color:#f92672">(</span>country<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Country</span><span style="color:#f92672">,</span> city<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">City</span><span style="color:#f92672">,</span> street<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span><span style="color:#f92672">,</span> house<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span><span style="color:#f92672">,</span> isConfirmed<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Boolean</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">City</span><span style="color:#f92672">(</span>name<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Country</span><span style="color:#f92672">(</span>name<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span><span style="color:#f92672">)</span>
</span></span></code></pre></div><p>If we want to increase <code>userRating</code> in this model then we will have to write such a code:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#66d9ef">val</span> updatedUser <span style="color:#66d9ef">=</span> user<span style="color:#f92672">.</span>copy<span style="color:#f92672">(</span>
</span></span><span style="display:flex;"><span>  generalInfo <span style="color:#66d9ef">=</span> user<span style="color:#f92672">.</span>generalInfo<span style="color:#f92672">.</span>copy<span style="color:#f92672">(</span>
</span></span><span style="display:flex;"><span>    siteInfo <span style="color:#66d9ef">=</span> user<span style="color:#f92672">.</span>generalInfo<span style="color:#f92672">.</span>siteInfo<span style="color:#f92672">.</span>copy<span style="color:#f92672">(</span>
</span></span><span style="display:flex;"><span>      userRating <span style="color:#66d9ef">=</span> user<span style="color:#f92672">.</span>generalInfo<span style="color:#f92672">.</span>siteInfo<span style="color:#f92672">.</span>userRating <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">)</span>
</span></span></code></pre></div><p>And we have to write the code below to confirm all of the addresses in BillInfo</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#66d9ef">val</span> updatedAddresses <span style="color:#66d9ef">=</span> user<span style="color:#f92672">.</span>billInfo<span style="color:#f92672">.</span>addresses<span style="color:#f92672">.</span>map<span style="color:#f92672">(</span><span style="color:#66d9ef">_</span><span style="color:#f92672">.</span>copy<span style="color:#f92672">(</span>isConfirmed <span style="color:#66d9ef">=</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">))</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">val</span> updatedUser <span style="color:#66d9ef">=</span> user<span style="color:#f92672">.</span>copy<span style="color:#f92672">(</span>
</span></span><span style="display:flex;"><span>	billInfo <span style="color:#66d9ef">=</span> user<span style="color:#f92672">.</span>billInfo<span style="color:#f92672">.</span>copy<span style="color:#f92672">(</span>addresses <span style="color:#66d9ef">=</span> updatedAddresses<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">)</span>
</span></span></code></pre></div><p>If we increase a level of nesting in our structures then we will considerably increase amount of a code like this. In such cases lens give a cleaner way to make changes in nested structures.</p>
        
        <div class="read-more-link">
            <a href="/posts/292173-lens-in-scala/">Read More…</a>
        </div>
        
        
    </article>
    <article class="post">
        <div class="info">
    <h1 class="post-title">
        <a href="https://coffius.github.io/posts/291279-true-fail-fast-with-expression-magic/">True fail-fast async error handling with Expression</a>
    </h1>
    
        <time datetime="2015-09-12T22:01:13&#43;0300" class="post-date">
            September 12, 2015
        </time>
    
    
    
    
    
    
    
</div>

        
        <p>How it was said in the previous <a href="http://koff.io/posts/290071-make-async-with-scalaz-either-and-futures" target="_blank">article</a> there is no way to do truly fail-fast async error handling using only scala or scalaz.</p>
<p>Look at the example below:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#66d9ef">val</span> longFut <span style="color:#66d9ef">=</span> longFuture<span style="color:#f92672">()</span> <span style="color:#75715e">// very long future
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">val</span> shortFut <span style="color:#66d9ef">=</span> shortFuture<span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">val</span> failedFut <span style="color:#66d9ef">=</span> failedFuture<span style="color:#f92672">()</span> <span style="color:#75715e">// throw new IllegalStateException(&#34;future is failed&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">val</span> result <span style="color:#66d9ef">=</span> <span style="color:#66d9ef">for</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  long <span style="color:#66d9ef">&lt;-</span> longFut
</span></span><span style="display:flex;"><span>  short <span style="color:#66d9ef">&lt;-</span> shortFut
</span></span><span style="display:flex;"><span>  failed <span style="color:#66d9ef">&lt;-</span> failedFut
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span> <span style="color:#66d9ef">yield</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  long <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; | &#34;</span> <span style="color:#f92672">+</span> short <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; | &#34;</span> <span style="color:#f92672">+</span> failed
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>In that example we will wait all the futures until we get <code>IllegalStateException</code> because <code>for-comprehension</code> always handle futures in the order which we define them since Scala translates the example above to this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>longFut<span style="color:#f92672">.</span>flatMap <span style="color:#f92672">{</span> long <span style="color:#66d9ef">=&gt;</span>
</span></span><span style="display:flex;"><span>  shortFut<span style="color:#f92672">.</span>flatMap <span style="color:#f92672">{</span> short <span style="color:#66d9ef">=&gt;</span>
</span></span><span style="display:flex;"><span>    failedFut<span style="color:#f92672">.</span>map <span style="color:#f92672">{</span> failed <span style="color:#66d9ef">=&gt;</span>
</span></span><span style="display:flex;"><span>      long <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; | &#34;</span> <span style="color:#f92672">+</span> short <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; | &#34;</span> <span style="color:#f92672">+</span> failed
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>But it is possible to avoid this problem with Expression library(<a href="https://github.com/jedesah/computation-expressions" title="Computation-expressions" target="_blank">link</a>)</p>
        
        <div class="read-more-link">
            <a href="/posts/291279-true-fail-fast-with-expression-magic/">Read More…</a>
        </div>
        
        
    </article>
    <article class="post">
        <div class="info">
    <h1 class="post-title">
        <a href="https://coffius.github.io/posts/290071-make-async-with-scalaz-either-and-futures/">Practical Scalaz: Make async operations with scalaz.Either and Futures</a>
    </h1>
    
        <time datetime="2015-09-05T22:01:13&#43;0300" class="post-date">
            September 5, 2015
        </time>
    
    
    
    
    
    
    
</div>

        
        <p>Many of us know about such library as scalaz. For those who don&rsquo;t know it is a library for functional programming in scala. You can find it <a href="https://github.com/scalaz/scalaz" title="Scalaz on github" target="_blank">here</a>.
Then I was trying to learn and understand this lib it was quite difficult to realize how exactly it can be used in a real code in a real system. I looked thought lots of articles about it, but there were only abstract examples. So I`ve decided to write a little example in order to show how scalaz can be used in a real system.</p>
<h2 id="intro">Intro</h2>
<p><strong>Idea:</strong> Future and scalaz.Either can be used as a result of an asynchronous operation.</p>
<p><strong>Reason:</strong> We must compose futures and eithers in order to deal with possible errors which may occur during execution of async operations.</p>
<p>For example we have to gather information from several different DBs and an external service like Twitter. We also don`t want to use exceptions as notifications about errors. Why? Because it sucks ^_^ It will be better if exceptions are used for something really exceptional. One more thing which we should implement is fail-fast error handling because it will be wasteful to continue program execution if it already contains some errors.</p>
        
        <div class="read-more-link">
            <a href="/posts/290071-make-async-with-scalaz-either-and-futures/">Read More…</a>
        </div>
        
        
    </article>
</div>



            </main>
            
        </div>
    </body>
</html>
